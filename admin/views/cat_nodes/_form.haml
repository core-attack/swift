- if @object.new?
  = f.input :cat_card_id, :as => :select, :selected => @object.cat_card_id, :collection => CatCard.all, :fields => [ :title, :id ], :include_blank => false

= f.input :title
= f.input :text, :as => :text, :markdown => true

- unless @object.new?
  .well
    - @object.cat_card.json.each do |key, type|
      - as = type[0].to_sym
      - opts = { :as => as, :label => { :caption => key }, :morphable => true, :value => @object.json[key] }
      - variants = type[1].split(/[\r\n]+/)
      - if as == :select
        - opts.delete :value
        - opts[:selected] = @object.json[key]
        - opts[:options] = variants
      - if as == :multiple
        - opts.delete :value
        .control-group.as_multiple.morphable
          
          = f.label( key, :class => 'control-label', :caption => key )
          - variants.each do |v|
            .controls.horizontal
              = label_back_tag v, :for => "cat_node[#{key}][#{v}]", :caption => v, :class => :checkbox do
                = check_box_tag "cat_node[#{key}][]", :value => v, :id => "cat_node[#{key}][#{v}]", :checked => Array(@object.json[key]).include?(v)
      - if as == :json
        = f.input key, opts.merge({:as => :text, :value => @object.json[key].kind_of?(String) ? @object.json[key] : @object.json[key].to_json })
      - else
        = f.input key, opts

- allow :auditor do
  = f.input :is_published, :as => :boolean
  = f.input :slug

= f.submits